/**
  ----------------------------------------------------------
   DynamicForm DynamicForm v 1.15.11
  ----------------------------------------------------------
   Built Friday, October 31st, 2014, 12:06:42 AM
  ----------------------------------------------------------
   https://mojo.redhat.com/docs/DOC-188933
  ----------------------------------------------------------
**/

!function(a){"use strict";var b=4,c=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB,d=a.IDBKeyRange||a.webkitIDBKeyRange;if(!c)throw"IndexedDB required";var e=function(a,b){var c=function(){var c=a.apply(this,arguments);return c.name=this.name=b,this.stack=c.stack,this.message=c.message,this};return c.prototype=Object.create(a.prototype,{constructor:{value:c}}),c},f=e(a.Error,"HustleError"),g=e(f,"HustleDBClosed"),h=e(f,"HustleDBOpened"),i=e(f,"HustleBadTube"),j=e(f,"HustleBadID"),k=e(a.Error,"HustleNotice"),l=e(k,"HustleNotFound"),m=function(a){a||(a={}),a.tubes||(a.tubes=[]);var e=(a.db_version?a.db_version:1,a.maintenance_delay?a.maintenance_delay:1e3),f=a.message_lifetime?a.message_lifetime:1e4,k=a.db_name?a.db_name:"hustle",m={ids:"_ids",reserved:"_reserved",delayed:"_delayed",buried:"_buried",pubsub:"_pubsub"};a.tubes.indexOf("default")<0&&a.tubes.push("default");var n,o=null,p=function(){if(!o)throw new g("Closed database being operated on. Did you call Hustle.open()?");return!0},q=function(a,b,c){c||(c={});var d=null,e=a.target.result,f=c.keypath?c.keypath:"id",g=c.autoincrement?c.autoincrement:!1;if(d=e.objectStoreNames.contains(b)?a.currentTarget.transaction.objectStore(b):e.createObjectStore(b,{keyPath:f,autoIncrement:g}),c.indexes)for(var h=Object.keys(c.indexes),i=0;i<h.length;i++)!function(a,b){var c=b.index?b.index:a,e=b.unique?!0:!1;try{d.createIndex(a,c,{unique:e})}catch(f){}}(h[i],c.indexes[h[i]]);return d},r=function(d){if(d||(d={}),o)throw new h("db is already open");var e=c.open(k,b);e.onerror=function(a){d.error&&d.error(a)},e.onsuccess=function(a){o=e.result,d.success&&d.success(a),n()},e.onupgradeneeded=function(b){var c=a.tubes;q(b,m.ids),q(b,m.reserved,{indexes:{expire:{index:"expire",unique:!1}}}),q(b,m.delayed,{indexes:{activate:{index:"activate",unique:!1}}}),q(b,m.buried,{indexes:{id:{unique:!1}}}),q(b,m.pubsub,{autoincrement:!0,indexes:{channel:{index:"channel",unique:!1},created:{index:"created",unique:!1}}});for(var d=0;d<c.length;d++)[m.reserved,m.buried].indexOf(c[d])>=0||q(b,c[d],{indexes:{priority:{index:["priority","id"],unique:!1}}})}},t=function(){return o?(o.close(),o=null,!0):!1},u=function(){return t(),c.deleteDatabase(k),!0},v=function(a){p(),a||(a={});var b=null,c=o.transaction([m.ids],"readwrite");c.oncomplete=function(c){return b?void(a.success&&a.success(b,c)):void(a.error&&a.error("bad id"))},c.onerror=function(b){a.error&&a.error(b)};var d=c.objectStore(m.ids),e=d.get("id");e.onsuccess=function(){var a=e.result;a?(a.value++,b=a.value,d.put(a)):(b=1,d.put({id:"id",value:1}))}},w=function(a,b,c,d){d||(d={});var e=o.transaction([b,c],"readwrite");e.oncomplete=function(a){d.success&&d.success(a)},e.onerror=function(a){d.error&&d.error(a)};var f,g=function(a,b){d.transform&&(a=d.transform(a));var f=e.objectStore(c),g=f.add(a);g.onsuccess=b},h=e.objectStore(b);if(b==m.buried){var i=h.index("id");f=i.get(a)}else f=h.get(a);f.onsuccess=function(){var c=f.result,e=c.id;return b==m.buried&&(e=c._id),c?void g(c,function(){var a=h.delete(e);a.onerror=d.error}):void(d.error&&d.error(new l("item "+a+" wasn't found")))}},x=function(a,b){for(var c={data:a},d=[{name:"priority",type:"int","default":1024},{name:"delay",type:"int","default":0},{name:"ttr",type:"int","default":0}],e=0;e<d.length;e++){var f=d[e];if(b[f.name])switch(c[f.name]=b[f.name],f.type){case"int":c[f.name]=parseInt(c[f.name]);break;case"float":c[f.name]=parseFloat(c[f.name])}f.default&&"undefined"==typeof c[f.name]&&(c[f.name]=f.default)}return c.age=0,c.reserves=0,c.releases=0,c.timeouts=0,c.buries=0,c.kicks=0,c.created=(new Date).getTime(),c},y=function(b,c){if(p(),c||(c={}),!b)return c.error&&c.error(new HustleBadId("bad id given")),!1;var d=null,e=[m.reserved,m.delayed,m.buried].concat(a.tubes),f=o.transaction(e,"readonly");f.oncomplete=function(a){return!d&&c.not_found_error?void(c.error&&c.error(new l("item "+b+" not found"))):void(c.success&&c.success(d,a))},f.onerror=function(a){c.error&&c.error(a)},e.forEach(function(a){var c;if(a==m.buried){var e=f.objectStore(a).index("id");c=e.get(b)}else c=f.objectStore(a).get(b);c.onsuccess=function(b){var c=b&&b.target&&b.target.result;return d||!c?!1:(d=c,d.age=Math.round(((new Date).getTime()-d.expire)/1e3),void(a==m.reserved?(d.state="reserved",d.ttr>0&&(d.time_left=Math.round((d.expire-(new Date).getTime())/1e3))):a==m.buried?d.state="buried":(d.state="ready",d.tube||(d.tube=a))))}})},z=function(b,c){if(p(),c||(c={}),!b)return!1;var d=c.tube?c.tube:"default";if(a.tubes.indexOf(d)<0)throw new i("tube "+d+" doesn't exist");var e=x(b,c);e.delay&&e.delay>0&&(e.tube=d,e.activate=(new Date).getTime()+1e3*e.delay,d=m.delayed,delete e.delayed),v({success:function(a){e.id=a;var b=o.transaction([d],"readwrite");b.oncomplete=function(a){c.success&&c.success(e,a)},b.onerror=function(a){c.error&&c.error(a)};var f=b.objectStore(d),g=f.add(e);g.onsuccess=function(a){e.id=a.target.result}},error:function(){c.error&&c.error(new j("error generating id"))}})},A=function(b){p(),b||(b={});var c=b.tube?b.tube:"default";if(a.tubes.indexOf(c)<0)throw new i("tube "+c+" doesn't exist");var d=null,e=o.transaction([m.reserved,c],"readwrite");e.oncomplete=function(a){b.success&&b.success(d,a)},e.onerror=function(a){b.error&&b.error(a)};var f=function(a,b){d=a,d.reserves++,d.tube=c,d.ttr>0&&(d.expire=(new Date).getTime()+1e3*d.ttr);var f=e.objectStore(m.reserved),g=f.add(d);g.onsuccess=b},g=e.objectStore(c),h=g.index("priority");h.openCursor().onsuccess=function(a){var c=a.target.result;c&&f(c.value,function(){var a=g.delete(c.value.id);a.onerror=b.error})}},B=function(a,b){p(),b||(b={}),y(a,{success:function(a){if(!a)return void(b.success&&b.success(null));var c=a.tube,d=a.id;"reserved"==a.state?c=m.reserved:"buried"==a.state&&(c=m.buried,d=a._id);var e=o.transaction(c,"readwrite");e.oncomplete=function(c){b.success&&b.success(a,c)},e.onerror=function(a){b.error&&b.error(a)},e.objectStore(c).delete(d)},error:b.error})},C=function(a,b){p(),b||(b={}),y(a,{not_found_error:!0,success:function(c){if("reserved"!=c.state)return void(b.error&&b.error(new l("item "+a+" isn't reserved")));var d=c.tube;if(b.delay){var e=parseInt(b.delay);e&&(c.activate=(new Date).getTime()+1e3*e,d=m.delayed)}w(a,m.reserved,d,{transform:function(a){if(a.releases++,b.priority){var c=parseInt(b.priority);c&&(a.priority=c)}return delete a.tube,a},success:b.success,error:b.error})},error:b.error})},D=function(a,b){p(),b||(b={}),y(a,{not_found_error:!0,success:function(c){if("buried"==c.state)return void(b.success&&b.success());var d=c.tube;"reserved"==c.state&&(d=m.reserved),w(a,d,m.buried,{transform:function(a){if(a.buries++,a.tube=c.tube,b.priority){var d=parseInt(b.priority);d&&(a.priority=d)}return a},success:b.success,error:b.error})},error:b.error})},E=function(b,c){p(),c||(c={});var d=0,e=[m.buried].concat(a.tubes),f=o.transaction(e,"readwrite");f.oncomplete=function(a){c.success&&c.success(d,a)},f.onerror=function(a){c.error&&c.error(a)};var g=function(a,b){a.kicks++;var c=a.tube;delete a._id,delete a.tube;var d=f.objectStore(c),e=d.add(a);e.onsuccess=b},h=f.objectStore(m.buried);h.openCursor().onsuccess=function(a){var e=a.target.result;e&&(g(e.value,function(){var a=h.delete(e.key);a.onerror=c.error}),d++,b>d&&e.continue())}},F=function(a,b){p(),b||(b={}),y(a,{not_found_error:!0,success:function(c){return"buried"!=c.state?void(b.error&&b.error(new l("item "+a+" isn't buried"))):void w(a,m.buried,c.tube,{transform:function(a){return a.kicks++,delete a._id,delete a.tube,a},success:b.success,error:b.error})},error:b.error})},G=function(a,b){p(),b||(b={}),y(a,{not_found_error:!0,success:function(c){if("reserved"!=c.state)return console.log("item.state: ",c.state),void(b.error&&b.error(new l("item "+a+" isn't reserved")));if(c.ttr<=0)return void(b.success&&b.success());var d=o.transaction(m.reserved,"readwrite");d.oncomplete=function(a){b.success&&b.success(a)},d.onerror=function(a){b.error&&b.error(a)};var e=d.objectStore(m.reserved),f=e.get(a);f.onsuccess=function(){var a=f.result;a.expire=(new Date).getTime()+1e3*a.ttr,e.put(a)}},error:b.error})},H=function(b,c){if(p(),c||(c={}),a.tubes.indexOf(b)<0)throw new i("tube "+b+" doesn't exist");var d=null,e=o.transaction(b,"readonly");e.oncomplete=function(a){c.success&&c.success(d,a)},e.onerror=function(a){c.error&&c.error(a)};var f=e.objectStore(b),g=f.count();g.onsuccess=function(){d=g.result}},I=function(a,b){b||(b={});var c=b.tube?b.tube:"default",d=b.delay?b.delay:100,e=!1,f=function(g){if(g||(g={}),!e&&o){if(b.enable_fn){var h=b.enable_fn();if(!h)return e=!0,!1}A({tube:c,success:function(b){b&&(a(b),setTimeout(function(){f({skip_recurse:!0})},0))}}),g.skip_recurse||setTimeout(f,d)}},g=function(){return e?(e=!1,setTimeout(f,d),!0):!1},h=function(){return e?!1:(e=!0,!0)};return setTimeout(f,d),this.start=g,this.stop=h,this},J=function(a,b,c){p(),c||(c={});var d={channel:a,data:b,created:(new Date).getTime()},e=o.transaction(m.pubsub,"readwrite");e.oncomplete=function(a){c.success&&c.success(d,a)},e.onerror=function(a){c.error&&c.error(a)};var f=e.objectStore(m.pubsub),g=f.add(d);g.onsuccess=function(a){d.id=a.target.result}},K=function(a,b,c){c||(c={});var e=c.delay?c.delay:100,g=!1,h={},i=function(){var a=Object.keys(h),b=(new Date).getTime();a.forEach(function(a){var c=h[a];b-(1e3+f)>c&&delete h[a]})},j=function(f){if(f||(f={}),!g&&o){if(c.enable_fn){var k=c.enable_fn();if(!k)return g=!0,!1}i();var l=null,n=o.transaction(m.pubsub,"readonly");n.oncomplete=function(){l&&b(l)},n.onerror=function(a){f.error&&f.error(a)};var p=n.objectStore(m.pubsub),q=p.index("channel");q.openCursor(d.only(a)).onsuccess=function(a){var b=a.target.result;b&&(h[b.value.id]?b.continue():(l=b.value,h[l.id]=(new Date).getTime(),setTimeout(function(){j({skip_recurse:!0})},0)))},f.skip_recurse||setTimeout(j,e)}},k=function(){return g?(g=!1,setTimeout(j,e),!0):!1},l=function(){return g?!1:(g=!0,!0)};return setTimeout(j,e),this.start=k,this.stop=l,this},L=function(a){a||(a={});var b=o.transaction(m.pubsub,"readwrite");b.oncomplete=function(b){a.success&&a.success(b)},b.onerror=function(b){a.error&&a.error(b)};var c=b.objectStore(m.pubsub),e=c.index("created"),g=(new Date).getTime()-f,h=d.upperBound(g);e.openCursor(h).onsuccess=function(a){var b=a.target.result;b&&(c.delete(b.value.id),b.continue())}},M=function(a){a||(a={});var b=[],c=o.transaction(m.delayed,"readonly");c.oncomplete=function(){b.forEach(function(a){w(a.id,m.delayed,a.tube,{error:function(a){console.error("Hustle: delayed move: ",a)}})})},c.onerror=function(b){console.error("Hustle: delayed move: ",b),a.error&&a.error(b)};var e=c.objectStore(m.delayed),f=e.index("activate"),g=(new Date).getTime(),h=d.upperBound(g);f.openCursor(h).onsuccess=function(a){var c=a.target.result;c&&(b.push(c.value),c.continue())}},N=function(a){a||(a={});var b=[],c=o.transaction(m.reserved,"readonly");c.oncomplete=function(){b.forEach(function(a){w(a.id,m.reserved,a.tube,{transform:function(a){return delete a.expire,a.timeouts++,a},error:function(a){console.error("Hustle: ttr move: ",a)}})})},c.onerror=function(b){console.error("Hustle: ttr move: ",b),a.error&&a.error(b)};var e=c.objectStore(m.reserved),f=e.index("expire"),g=(new Date).getTime(),h=d.upperBound(g);f.openCursor(h).onsuccess=function(a){var c=a.target.result;c&&(b.push(c.value),c.continue())}};n=function(){var a=function(){return o?(L(),M(),N(),void setTimeout(a,e)):!1};setTimeout(a,e)};var O={peek:y,put:z,reserve:A,"delete":B,release:C,bury:D,kick:E,kick_job:F,touch:G,count_ready:H,Consumer:I},P={publish:J,Subscriber:K};return this.open=r,this.close=t,this.is_open=function(){return!!o},this.wipe=u,this.Pubsub=P,this.Queue=O,this.promisify=function(){var a=this,b=function(b,c){return function(){var d=Array.prototype.slice.call(arguments,0);return d[c]||(d[c]={}),new Promise(function(e,f){d[c].success=e,d[c].error=f,b.apply(a,d)})}};this.open=b(this.open,0),this.Queue.peek=b(this.Queue.peek,1),this.Queue.put=b(this.Queue.put,1),this.Queue.reserve=b(this.Queue.reserve,0),this.Queue.delete=b(this.Queue.delete,1),this.Queue.release=b(this.Queue.release,1),this.Queue.bury=b(this.Queue.bury,1),this.Queue.kick=b(this.Queue.kick,1),this.Queue.kick_job=b(this.Queue.kick_job,1),this.Queue.touch=b(this.Queue.touch,1),this.Queue.count_ready=b(this.Queue.count_ready,1),this.Pubsub.publish=b(this.Pubsub.publish,2)}.bind(this),this.debug={get_db:function(){return o}},this};a.Hustle=m}(window);
//# sourceMappingURL=hustle.min.map