/**
  ----------------------------------------------------------
   DynamicForm DynamicForm v 1.15.11
  ----------------------------------------------------------
   Built Friday, October 31st, 2014, 12:06:42 AM
  ----------------------------------------------------------
   https://mojo.redhat.com/docs/DOC-188933
  ----------------------------------------------------------
**/

var DemandbaseForm=window.DemandbaseForm||{};DemandbaseForm.formConnector={name:"Demandbase Form Module",key:"ebe01af61745f0b84a1e122fcf96909601eb380c",emailID:"C_EmailAddress",companyID:"C_Company",form:function(){return document.forms[jQuery("#C_EmailAddress").closest("form").attr("name")]}(),debug:!1,testing:!1,logging:!1,useTestIp:!1,testIpAddress:"30.0.0.1",useCompanyInputMatch:!1,useIspFilter:!0,keepAudienceFields:!1,cacLabel:"{marketing_alias} ({city}, {state})",hiddenFieldMap:{revenue_range:"DB_Annual_Revenue",state:"DB_State_Prov",zip:"DB_Zip_Postal",country_name:"DB_Country",duns_num:"DB_DUNS_Number",audience:"DB_Audience",audience_segment:"DB_Audience_Segment",industry:"DB_Industry",employee_range:"DB_Employee_Band",ip:"DB_IP",demandbase_sid:"DB_DemandBaseID",fortune_1000:"DB_Fortune1000",marketing_alias:"DB_Marketing_Alias",employee_count:"DB_Employee_Count",annual_sales:"DB_Annual_Sales",web_site:"DB_Website",primary_sic:"DB_Primary_SIC",watch_list_SalesForceAcctID:"DB_SalesForce_AccountID",watch_list_OracleAcctID:"DB_Oracle_PartyID"},visibleFieldMap:{},priorityMap:{domain:3,ip:2,company:1},requiredAttrsList:["company_name"],toggleFieldList:[],connect:function(a){a||(a={}),a.key&&(this.key=a.key),a.companyID&&(this.companyID=a.companyID),a.emailID&&(this.emailID=a.emailID),a.form&&(this.form=a.form),console.info("demandbase options form: ",a.form),console.info("demandbase using form: ",this.form),a.formNameList&&(this.formNameList=a.formNameList),a.testIpAddress&&(this.testIpAddress=a.testIpAddress),a.cacLabel&&(this.cacLabel=a.cacLabel),a.hiddenFieldMap&&(this.hiddenFieldMap=a.hiddenFieldMap),a.visibleFieldMap&&(this.visibleFieldMap=a.visibleFieldMap),a.priorityMap&&(this.priorityMap=a.priorityMap),a.requiredAttrsList&&(this.requiredAttrsList=a.requiredAttrsList),a.toggleFieldList&&(this.toggleFieldList=a.toggleFieldList),"undefined"==typeof a.debug||this._isNullEmpty(a.debug)||(this.debug=a.debug),"undefined"==typeof a.testing||this._isNullEmpty(a.testing)||(this.testing=a.testing),"undefined"==typeof a.logging||this._isNullEmpty(a.logging)||(this.logging=a.logging),"undefined"==typeof a.useTestIp||this._isNullEmpty(a.useTestIp)||(this.useTestIp=a.useTestIp),"undefined"==typeof a.useIspFilter||this._isNullEmpty(a.useIspFilter)||(this.useIspFilter=a.useIspFilter),"undefined"==typeof a.useCompanyInputMatch||this._isNullEmpty(a.useCompanyInputMatch)||(this.useCompanyInputMatch=a.useCompanyInputMatch),"undefined"==typeof a.keepAudienceFields||this._isNullEmpty(a.keepAudienceFields)||(this.keepAudienceFields=a.keepAudienceFields),this._log("Module Run with Options: "),this._log(a)},init:function(){"undefined"!=typeof Demandbase?(Demandbase.jQuery(document).ready(function(){var a=DemandbaseForm.formConnector;a.testing&&a._authorize(),a._loadAsyncScript(),a._attachCompanyAPI();for(formName in a.formNameList)if(a.form=document.forms[a.formNameList[formName]],null!=a.form)break;a.form||(a.form=document.forms[0]),""!==Demandbase.jQuery("#"+a.emailID).val()&&Demandbase.CompanyAutocomplete.getPerson(Demandbase.CompanyAutocomplete.callback),a.toggleFieldList.length>0&&a.toggleFields(),db_hook_init()}),this._log("Initializing "+this.name+" v."+this._version)):(this._loadAsyncScript(),this._log("Initializing "+this.name+" v."+this._version+"... \nFAILED - widget.js file not loaded"))},parser:function(a){if(!a)return"";try{var b,c;if("object"==typeof a.person){if(c="domain",this._sourceChecker.setSource(c,this._isIdComplete(a),!0),!a.person)return;if(a=a.person,this._dbDataSet&&a.demandbase_sid==this._dbDataSet.demandbase_sid)return}else if(a.pick||a.input_match)c="company",a.pick&&(a=a.pick),this.useCompanyInputMatch&&a.input_match&&(a=a.input_match,this._log("Using input_match object from Company Name API...")),a.manual_review=!0;else if(c="ip",this._detectedIP=a.ip||"",this._detectedAudience=a.audience||"",this._detectedAudienceSegment=a.audience_segment||"",this._log("Queried IP Address: "+this._detectedIP),a.isp===!0&&this.useIspFilter)return;if(this._log("Parsing response from API: "+c),this._sourceChecker.setSource(c,this._isIdComplete(a),!0),this._dbDataSet&&(isIdMatch=a.demandbase_sid==this._dbDataSet.demandbase_sid),db_hook_before_parse(a,c),b=this.priorityMap[c],null!==this._lastDataSource&&b<this._lastDataSource&&!isIdMatch&&"domain"!==this._dbDataSet)return;this._dbDataSet=a,this._dbDataSrc=c,this._removeDataset(a),this._log("Parsing data response from: "+this._dbDataSrc),this._log("New Data Set:"),this._log(this._dbDataSet),a=this._flattenData(a),this._restoreIpFields(a);var d=document.createElement("fieldset");d.id="db_data_container",d.style.cssText="border:none;";for(attr in a){var e=a[attr]||"",f=this._buildHiddenField(attr,e);if(this.testing){var g=document.createElement("div");g.setAttribute("id",f.id+"_container"),g.innerHTML="<strong>"+f.id+"</strong>: "+f.value+"<br/>",d.appendChild(g)}this._prepopVisibleFields(attr,e),d.appendChild(f),db_hook_attr(c,attr,e)}this.form&&(this.form.appendChild(d),this._lastDataSource=b),db_hook_after_parse(a,c)}catch(h){this.debug&&alert("Error: "+h+" \n "+h.stack)}},_flattenData:function(a){for(d in a)if("object"==typeof a[d]&&null!==a[d]){for(nd in a[d])a[d+"_"+nd]=a[d][nd];delete a[d]}return a},_restoreIpFields:function(a){a&&("undefined"!=typeof a.ip||this._isNullEmpty(this._detectedIP)||(a.ip=this._detectedIP),this.keepAudienceFields&&(this._isNullEmpty(this._detectedAudience)||(a.audience=this._detectedAudience),this._isNullEmpty(this._detectedAudienceSegment)||(a.audience_segment=this._detectedAudienceSegment)))},_normalize:function(a){var b="db_";return this.hiddenFieldMap[a]?this.hiddenFieldMap[a]:b+a},_buildHiddenField:function(a,b){var c=this._normalize(a),d=this._getElmByIdOrName(c),e=c;d&&(e=d.id,d.parentNode.removeChild(d));var f=document.createElement("input");return f.setAttribute("id",e),f.setAttribute("name",c),f.setAttribute("type","hidden"),f.value=b,f},_prepopVisibleFields:function(a,b){if(this.visibleFieldMap[a]){var c=!1,d=this._getElmByIdOrName(this.visibleFieldMap[a]);if(d){if("select-one"==d.type){for(var e=0;e<d.options.length;e++)if(d.options[e].value==b){c=d.options[e].selected=!0;break}}else d.value=b,c=!0;c&&Demandbase.jQuery(d).change().parents("p")}}},_getElmByIdOrName:function(a){var b=document.getElementById(a);return b||(b=this.form.elements.namedItem(a),b&&b instanceof NodeList&&(b=b[0])),b},_getQueryParam:function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("="),g=f[0],h=f[1];d[g]=h}return d[a]},_attachCompanyAPI:function(){if(Demandbase.CompanyAutocomplete){Demandbase.CompanyAutocomplete.widget({company:this.companyID,email:this.emailID,key:this.key,label:this.cacLabel,callback:function(a){DemandbaseForm.formConnector.parser(a)}});var a,b;a=DemandbaseForm.formConnector,b=Demandbase.jQuery,b("#"+a.companyID).bind("autocompletecreate",function(){b(this).autocomplete("option","change",function(b,c){Demandbase.CompanyAutocomplete._change.call(this,b,c),a._sourceChecker.checkSources()})}).blur(function(){a._sourceChecker.setSource("company")})}this._log("Attached CompanyAutocomplete Widget to form: "+this.form),this._log("Attached CompanyAutocomplete Widget to email/company fields: "+this.emailID+" / "+this.companyID)},_loadAsyncScript:function(){var s=document.createElement("script");if(s.src=("https:"==document.location.protocol?"https://":"http://")+"api.demandbase.com/api/v2/ip.json?key="+this.key+"&referrer="+document.referrer+"&page="+document.location.href+"&page_title="+document.title+"&callback=DemandbaseForm.formConnector.parser&query=",this.useTestIp){var a=this._getQueryParam("dbip");a&&""!==a?(this.testIpAddress=a,this._log("Overriding IP Address from query string: "+this.testIpAddress)):this._log("Overriding IP Address from internal: "+this.testIpAddress),s.src=s.src+this.testIpAddress}document.getElementsByTagName("head")[0].appendChild(s),this._log("Loaded IP Address API"),this._sourceChecker.setSource("ip")},_isIdComplete:function(a){if(triggerFieldList=this.requiredAttrsList,a)for(field in triggerFieldList)if(!a[triggerFieldList[field]]||""==a[triggerFieldList[field]])return!1;return!0},toggleFields:function(){for(field in this.toggleFieldList)fieldId=this.toggleFieldList[field],""!==fieldId&&Demandbase.jQuery("#"+fieldId).toggle()},_resetFields:function(a){for(field in this.visibleFieldMap)if("undefined"==typeof a[field]||this._isNullEmpty(a[field])){var b=this.visibleFieldMap[field];Demandbase.jQuery('[id="'+b+'"]').val("")}for(field in this.hiddenFieldMap)if("undefined"==typeof a[field]||this._isNullEmpty(a[field])){var b=this.hiddenFieldMap[field];Demandbase.jQuery('[id="'+b+'"]').val("")}},_removeDataset:function(a){var b=document.getElementById("db_data_container");b&&(this.form.removeChild(b),this._resetFields(a))},_isNullEmpty:function(a){return null==a||""===a?!0:!1},_log:function(){this.logging&&console.log.apply(window.console,["DemandbaseForm:"].concat([].splice.call(arguments,0)))},_authorize:function(){Demandbase.jQuery.ajax({url:"http://api.demandbase.com/api/v2/ip.json",data:{key:this.key},dataType:"jsonp",timeout:2e3,success:function(){DemandbaseForm.formConnector._isAuthorized=!0,DemandbaseForm.formConnector._log("Validating key....authorized="+DemandbaseForm.formConnector._isAuthorized)},error:function(){DemandbaseForm.formConnector._isAuthorized=!1,DemandbaseForm.formConnector._log("Validating key....authorized="+DemandbaseForm.formConnector._isAuthorized),alert("The Demandbase key is not valid.")}})},_lastDataSource:null,_detectedIP:null,_detectedAudience:null,_detectedAudienceSegment:null,_dbDataSet:null,_dbDataSrc:null,_isAuthorized:null,_version:"beta_0.2",_sourceChecker:{sources:{ip:{hit:!1,result:!1},company:{hit:!1,result:!1},domain:{hit:!1,result:!1}},setSource:function(a,b,c){b||(b=!1),this.sources[a].hit=!0,this.sources[a].result=b,DemandbaseForm.formConnector._log("API response logged with SourceChecker: "+a+" : "+b),c&&this.checkSources()},checkSources:function(){var a=!1,b=!0;for(source in this.sources)if(this.sources[source].result&&(a=!0),!this.sources[source].hit){b=!1;break}b&&this.onAllHit(),b&&!a&&this.onNoId()},onNoId:function(){DemandbaseForm.formConnector._log("All APIs hit with no identification. Running onNoId function..."),DemandbaseForm.formConnector.toggleFields(),db_hook_no_id()},onAllHit:function(){db_hook_all_hit()}}},"undefined"==typeof window.console&&(window.console={log:function(){},debug:function(){}}),"undefined"==typeof db_hook_init&&(db_hook_init=function(){}),"undefined"==typeof db_hook_all_hit&&(db_hook_all_hit=function(){}),"undefined"==typeof db_hook_no_id&&(db_hook_no_id=function(){}),"undefined"==typeof db_hook_attr&&(db_hook_attr=function(){}),"undefined"==typeof db_hook_before_parse&&(db_hook_before_parse=function(){}),"undefined"==typeof db_hook_after_parse&&(db_hook_after_parse=function(){}),DemandbaseForm.formConnector.init();
//# sourceMappingURL=demandbaseForm.min.map